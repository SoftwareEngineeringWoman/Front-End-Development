import"./open-interstitial-modal-0fb87852.js";import"./confirm-over-18-c537dedf.js";import{i as t,c as e,_ as i,n as s,t as n,s as o,u as r,eR as l,eS as a,x as c,d,f as p,e as h,Z as m}from"./shell-cc43a7af.js";import"./reddit-page-data-818c7058.js";import"./shreddit-comments-page-ad-a91a80da.js";import"./shreddit-tweet-embed-01c13606.js";import"./icon-caret-left-59634df0.js";import"./icon-caret-right-7f3a1ba7.js";import"./faceplate-tabgroup-946b241f.js";import"./faceplate-tabpanel-ca468c87.js";import"./shreddit-search-7e508fd8.js";import"./shreddit-lead-generation-ad-dialog-3e6b5461.js";import"./comment-body-header-cc195a60.js";import{i as f}from"./icon-embed-outline-3a45c9b5.js";import"./author-flair-event-handler-d7370217.js";import"./mod-notes-opener-111273c2.js";import"./guard-community-modal-781a4708.js";import{t as u}from"./icon-block-outline-a993b55f.js";import"./chat-channel-recommendations-wrapper-43e5d948.js";import"./index-adab87bf.js";import"./index-8e6d0f1a.js";import"./icon-play-fill-4690da25.js";import"./faceplate-tablist-ce719c54.js";import"./pageable-832f4cce.js";import"./icon-caret-left-outline-83c0b176.js";import"./icon-caret-right-outline-4a40bfa5.js";import"./icon-search-7d513d22.js";import"./search-helpers-a3a9f584.js";import"./faceplate-bottom-sheet-f98b541d.js";import"./TinyGesture-32f2fddd.js";import"./faceplate-bottom-sheet-header-9f404ea1.js";import"./faceplate-text-input-213f2294.js";import"./faceplate-checkbox-input-abe44898.js";import"./checked-input-element-740fc600.js";import"./icon-checkbox-outline-4b15db06.js";import"./comment-composer-host-8abbfd2c.js";import"./rte-toolbar-button-emote-0af0e31f.js";import"./mention-node-94764cdf.js";import"./icon-delete-outline-376be535.js";import"./icon-edit-outline-06a8096b.js";import"./upload-to-s3-d23260d1.js";import"./reputation-recaptcha-1049195f.js";import"./load-lazy-script-with-nonce-39f6ea07.js";import"./dom-47572497.js";import"./composer-14b337a4.js";import"./sleep-a1fd43c3.js";import"./faceplate-progress-3c1f8826.js";import"./telemetry-event-struct-69015fe2.js";import"./commentsPage-83d98a72.js";import"./mod-notes-5a7635f6.js";import"./icon-spoiler-outline-feee73ee.js";import"./icon-privacy-outline-a9669f5d.js";const b=t=>t.replace(/\n/g,"").replace(/\s+/g," ").trim(),g=({commentId:t,noPrefix:e})=>{let i=t.replace("-comment-rtjson-content","");return e&&(i=i.replace("t1_","")),i},j=({commentId:t,permalink:e,snippetData:i})=>t?`https://publish.reddit.com/embed?url=https://www.reddit.com${e.replace(/\/[^/]+(?=\/$)|\/$/,"")}comment/${g({commentId:t,noPrefix:!0})}?snippet=${i}`:`https://publish.reddit.com/embed?url=https://www.reddit.com${e}?snippet=${i}`,x=["TR","TH","TD","TABLE","TBODY","THEAD"],T=new Set(["H1","P"]);let C=class extends o{constructor(){super(...arguments),this.postId="",this.permalink="",this.topOffset=0,this.leftOffset=0,this.snippetData="",this.isTitleSelected=!1,this.isSelectionOutOfRange=!1,this.isFullTextSelected=!1,this.isComment=!1,this.clearSelection=t=>{if(2!==t.button&&t.target.getAttribute("postid")!==this.postId){const e=((t,e)=>{for(;t;){if(t.id&&(t.id.includes(`${e}-post-rtjson-content`)||t.id.includes("-comment-rtjson-content")))return t;t=t.parentNode}return null})(t.target,this.postId);this.richTextContainer=e,getSelection()?.empty(),this.snippetData="",this.isTitleSelected=!1,this.isSelectionOutOfRange=!1,this.isFullTextSelected=!1}},this.handleEmbedClick=()=>{this.isComment&&this.richTextContainer?.id?open(j({commentId:this.richTextContainer?.id,permalink:this.permalink,snippetData:this.snippetData}),"RedditEmbed"):open(j({permalink:this.permalink,snippetData:this.snippetData}),"RedditEmbed"),this.sendClickTelemetry()},this.isTripleClickHandled=t=>3===t.detail,this.getChildTextNode=t=>{let e;const i=t.childNodes;for(let t=0;t<i.length;t++){const s=i[t];if("#text"!==s.nodeName)continue;0!==b(s.textContent||"").length&&(e=s)}return e},this.getCorrectSelection=t=>{const e=getSelection();if(this.isTripleClickHandled(t)&&e?.anchorNode?.nodeName&&T.has(e?.anchorNode?.nodeName)){const t=this.getChildTextNode(e.anchorNode),i=t?.textContent?.length||0;e.setBaseAndExtent(t,0,t,i)}return e},this.calculateSnippetData=t=>{if(this.shouldShowButton)return void this.clearSelection(t);this.isComment=Boolean(this.richTextContainer?.id&&this.richTextContainer.id.startsWith("t1")),this.snippetData="";const e=this.getCorrectSelection(t),i=b(e?.toString()||"");if(!e||!i?.length)return;const s=this.richTextContainer?b(this.richTextContainer.innerText):"",n=b(this.postTitleElement.innerText);this.richTextContainer&&i===s&&(this.isFullTextSelected=!0);const o=e?.anchorNode;if(o.parentNode?.nodeName&&x.includes(o.parentNode?.nodeName))return;const r=e.getRangeAt(0);o.parentNode===this.postTitleElement&&(this.isTitleSelected=!0),(this.isTitleSelected&&i.length>n.length||this.richTextContainer&&i.length>s.length)&&(this.isSelectionOutOfRange=!0);const l=this.isTitleSelected?this.postTitleElement?.getBoundingClientRect():this.richTextContainer?.getBoundingClientRect(),a=e?.getRangeAt(0).getBoundingClientRect();if(l&&a){if(this.topOffset=a.top+scrollY,this.leftOffset=a.left+a.width/2,this.shadowRoot?.host.style.setProperty("--left-offset",`${this.leftOffset}px`),this.shadowRoot?.host.style.setProperty("--top-offset",this.topOffset-32-4+"px"),this.isTitleSelected||this.isFullTextSelected)return void this.sendViewTelemetry();if(e.rangeCount>0){let t=-1;const e=Array.from((this.isComment?this.richTextContainer?.children[0].children:this.richTextContainer?.children)||[]).filter((t=>"#text"!==t.nodeName));for(let i=0;i<e.length;i++){const s=e[i];if(r.intersectsNode(s)){t=i;break}}if(-1!==t&&i){const s=(({nodeText:t,selectedText:e})=>{if(!t||!e)return-1;const i=t.length,s=e.length,n=[];for(let t=0;t<=i;t++)n[t]=new Array(s+1).fill(0);let o=0,r=0;for(let l=1;l<=i;l++)for(let i=1;i<=s;i++)t[l-1]===e[i-1]&&(n[l][i]=n[l-1][i-1]+1,n[l][i]>o&&(o=n[l][i],r=l-1));const l=t.substring(r-o+1,r+1);return l?t.indexOf(l):-1})({nodeText:b(e[t].innerText),selectedText:i});t>-1&&s>-1&&i.length>0&&(this.snippetData=`${t}_${s}_${i.length}`,this.sendViewTelemetry())}}}},this.getEventDetails=()=>{const t={};return this.isComment&&this.richTextContainer?.id&&(t.comment={id:g({commentId:this.richTextContainer.id})}),t},this.sendViewTelemetry=()=>{const t=this.getEventDetails();this.dispatchEvent(r(l,{details:t}))},this.sendClickTelemetry=()=>{const t=this.getEventDetails();this.dispatchEvent(r(a,{details:t}))}}get shouldShowButton(){return(this.snippetData.length||this.isTitleSelected||this.isFullTextSelected)&&!this.isSelectionOutOfRange}connectedCallback(){super.connectedCallback();const t=document.getElementById(`post-title-${this.postId}`);t&&(this.postTitleElement=t),document.addEventListener("mousedown",this.clearSelection),document.addEventListener("mouseup",this.calculateSnippetData)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("mousedown",this.clearSelection),document.removeEventListener("mouseup",this.calculateSnippetData)}render(){return c`\n ${this.shouldShowButton?c`\n <div class="button-container bg-neutral-content-strong rounded-full shadow-sm flex">\n ${d({appearance:"plainInverted",size:p.Small,attributes:{onclick:this.handleEmbedClick},leadingIcon:f(),children:"Embed"})}\n </div>\n `:""}\n `}};C.styles=[t`.button-container{position:absolute;left:var(--left-offset);top:var(--top-offset);transform:translateX(-50%);z-index:1}`,e],i([s({type:String})],C.prototype,"postId",void 0),i([s({type:String})],C.prototype,"permalink",void 0),i([n()],C.prototype,"topOffset",void 0),i([n()],C.prototype,"leftOffset",void 0),i([n()],C.prototype,"snippetData",void 0),i([n()],C.prototype,"isTitleSelected",void 0),i([n()],C.prototype,"isSelectionOutOfRange",void 0),i([n()],C.prototype,"isFullTextSelected",void 0),i([n()],C.prototype,"isComment",void 0),C=i([h("embed-snippet-share-button")],C);let y=class extends o{static get styles(){return t`:host{display:block;position:relative}`}render(){return c`\n <slot></slot>\n <slot name="link"></slot>\n `}};y=i([h("post-media-container")],y);let S=class extends o{constructor(){super(...arguments),this.replaceItselfWithChildren=()=>{this.replaceWith(...this.childNodes)}}render(){return c`<div class="mx-md xs:mx-0">\n <div \n class="items-center justify-between flex flex-row py-sm px-md w-100 bg-neutral-background border-neutral-border rounded-[8px] border-solid border box-border" \n>\n <div>\n ${u({size:m.Medium,attributes:{className:"align-middle mr-2xs"}})}\n <span class="text-neutral-content-weak">\n Posted by a blocked account\n </span>\n </div>\n\n ${d({appearance:"secondary",size:p.Small,attributes:{rel:"nofollow",id:"primary-button",onclick:this.replaceItselfWithChildren},children:"View Post"})}\n </div>\n </div>`}};S.styles=[e],S=i([h("shreddit-blocked-post-content")],S),import("./shell-cc43a7af.js").then((function(t){return t.gH})),import("./faceplate-progress-3c1f8826.js"),import("./shell-cc43a7af.js").then((function(t){return t.gG}));
//# sourceMappingURL=pdp-client-js-ba5c676b.js.map
