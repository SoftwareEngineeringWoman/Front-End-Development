import{c as t,_ as e,s,ag as a,x as i,ah as r,e as n,a as o,H as l,q as c,n as d,aX as h,aY as p,r as u,t as b,b_ as g,e8 as m,a_ as f}from"./shell-cc43a7af.js";import"./icon-caret-left-59634df0.js";import"./icon-caret-right-7f3a1ba7.js";import"./faceplate-tabgroup-946b241f.js";import"./faceplate-tabpanel-ca468c87.js";import"./pdp-right-rail-post-translator-8a35da7f.js";import{B as v}from"./base-translator-eacf7a73.js";import"./faceplate-tablist-ce719c54.js";import"./pageable-832f4cce.js";import"./icon-caret-left-outline-83c0b176.js";import"./icon-caret-right-outline-4a40bfa5.js";import"./index-6f1b0f36.js";import"./i18n-8e288ca1.js";var C;const T=["global/view/discovery_unit","right_rail/click/panel_tab","right_rail/view/panel_tab","post/view/post","post/consume/post","post/click/post","post/click/subreddit","post/click/comments"];let k=C=class extends s{constructor(){super(),this.tabPanelsRef=a(),this.tabSelectCallback=t=>{for(const e of t)if("attributes"===e.type&&"faceplate-tab-selected"===e.attributeName&&e.target.nodeType===Node.ELEMENT_NODE){e.target.hasAttribute("faceplate-tab-selected")&&this.handleTabSelect(e.target)}},this.tabSelectObserver=new MutationObserver(this.tabSelectCallback),this.handlePDPRightRailTelemetry=t=>{const e=t.detail.details||t.detail;if(s=e,!T.includes(o(s)))return;var s;let a;try{const e=t?.target,s=e?.closest("span[event-data]")?.getAttribute("event-data")??e?.closest("reddit-pdp-right-rail-post")?.getAttribute("event-data");a=s?JSON.parse(decodeURIComponent(s)):{}}catch{a={}}e.action_info={...e.action_info,...a.action_info,type:"right_rail"},"post"===e.source&&(e.post=a.post||{},e.subreddit=a.subreddit||{})},this.handleTabSelect=t=>{const e=t.slot;e&&this.querySelector(`[slot="tab-panel"] [slot="${e}"] faceplate-partial[loading="programmatic"]`)?.load()},this.handleButtonClick=t=>{t.preventDefault()},this.addEventListener("faceplate-track",this.handlePDPRightRailTelemetry),this.addEventListener("track-event",this.handlePDPRightRailTelemetry)}firstUpdated(){this.querySelector('[slot="tabs"]')?.addEventListener("click",this.handleButtonClick)}connectedCallback(){super.connectedCallback(),this.tabSelectObserver.observe(this,C.tabSelectObserverOptions)}disconnectedCallback(){super.disconnectedCallback(),this.tabSelectObserver.disconnect(),this.querySelector('[slot="tabs"]')?.removeEventListener?.("click",this.handleButtonClick)}render(){return i`\n <div>\n <slot name="tabs" class="block sticky z-1 top-0 bg-neutral-background"></slot>\n <div ${r(this.tabPanelsRef)} class="pt-sm pb-lg">\n <slot name="tab-panel"></slot>\n </div>\n </div>\n `}};k.styles=[t],k.tabSelectObserverOptions={childList:!0,subtree:!0,attributes:!0,attributeFilter:["faceplate-tab-selected"]},k=C=e([n("pdp-right-rail")],k);const y=l(c(s));let S=class extends y{constructor(){super(...arguments),this.postId="",this.consumeTimeoutId=null,this._outboundLinkTrackingController=new h(this,(()=>({pageType:p(),postId:this.postId})))}connectedCallback(){super.connectedCallback(),this.enableObserver()}disconnectedCallback(){super.disconnectedCallback(),this.disableObserver(),this.clearConsumeTimeout()}clearConsumeTimeout(){this.consumeTimeoutId&&(clearTimeout(this.consumeTimeoutId),this.consumeTimeoutId=null)}observerIsIntersectingCallback(){this.consumeTimeoutId=setTimeout((()=>{this.trackEvent(u({source:"post",action:"consume",noun:"post"}))}),2e3)}observerIsNotIntersectingCallback(){this.clearConsumeTimeout()}createRenderRoot(){return this}};e([d({type:String,attribute:"post-id"})],S.prototype,"postId",void 0),S=e([n("reddit-pdp-right-rail-post")],S);const _=".i18n-right-rail-topic-name";let I=class extends v{constructor(){super(...arguments),this.isFetchingTranslations=!1,this._partialRequestController=new g(this)}async onTranslationsEnabled(){if(this.translatedStringsCache)return void this.renderStrings(this.translatedStringsCache);if(this.isFetchingTranslations)return;const t=this.getTranslatableContent();if(!t)return;this.originalStringsCache=t;const e=await this.fetchTranslations(t);e&&(this.translatedStringsCache=e,this.translationContextValue.isTranslationActive&&this.renderStrings(e))}async onTranslationsDisabled(){this.originalStringsCache&&this.renderStrings(this.originalStringsCache)}getTranslatableContent(){const t=[],e=this.querySelectorAll(_)||[];return Array.from(e).forEach((e=>{const s=e.innerHTML;s&&t.push(s)})),t}async fetchTranslations(t){const e=new FormData;let s;for(s of t)e.append("strings[]",s);this.isFetchingTranslations=!0;const a=await this._partialRequestController.request("/svc/shreddit/translated-strings",{method:m.Post,body:e});this.isFetchingTranslations=!1;const i=await(a?.text());if(!i)return null;const r=f(i);return Array.from(r).map((t=>t.innerHTML))}renderStrings(t){const e=this.querySelectorAll(_)||[];Array.from(e).forEach(((e,s)=>{const a=f(`<span>${t[s]}</span>`);e.replaceChildren(a[0])}))}render(){return i`<div><slot></slot></div>`}};I.styles=[t],e([b()],I.prototype,"translatedStringsCache",void 0),e([b()],I.prototype,"originalStringsCache",void 0),e([b()],I.prototype,"isFetchingTranslations",void 0),I=e([n("pdp-right-rail-topic-translator")],I);
//# sourceMappingURL=pdp-right-rail-content-client-js-34886746.js.map
